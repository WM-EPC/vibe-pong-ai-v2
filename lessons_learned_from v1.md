# Vibe Pong AI - Lessons Learned

This document records key insights, troubleshooting steps, and decisions made during the development of Vibe Pong AI.

## Vercel Deployment Troubleshooting (V0.1)

**Problem:** Initial deployment resulted in a black screen on the Vercel URL, despite working correctly on the local development server (`webpack serve`). Build logs showed success but potentially very large bundle sizes.

**Key Findings & Solutions:**

1.  **Bundle Size (Phaser):**
    *   **Finding:** The default Webpack build bundled the entire Phaser library, resulting in an excessively large `bundle.js` (~13.5 MB), causing performance issues (slow load/execution) even without explicit errors.
    *   **Solution:** Configured Phaser as an external library (`externals: { phaser: 'Phaser' }` in `webpack.config.js`) and loaded it via a CDN `<script>` tag in `index.html`. This drastically reduced `bundle.js` size (~30 KB).

2.  **Script Load Order (CDN vs. Bundle):**
    *   **Finding:** Placing the Phaser CDN script in `<head>` and relying on default Webpack injection of `bundle.js` at the end of `<body>` created a potential race condition where `bundle.js` might execute before the global `Phaser` object was defined by the CDN script.
    *   **Solution:** Moved the Phaser CDN `<script>` tag to the end of `<body>`, placed *before* where `bundle.js` is injected. Removed the `DOMContentLoaded` listener in `src/index.ts` and called `initGame()` directly, ensuring Phaser is loaded first.

3.  **Webpack Production Mode:**
    *   **Finding:** `webpack.config.js` had `mode: 'development'` hardcoded, potentially overriding the `--mode=production` flag used by the `npm run build` script on Vercel.
    *   **Solution:** Removed the hardcoded `mode` from `webpack.config.js`, allowing the command-line flag to control the build mode correctly.

4.  **Vercel Output Directory / `HtmlWebpackPlugin` Processing:**
    *   **Finding:** Vercel was apparently serving the raw `public/index.html` template instead of the processed version from the `dist` directory generated by Webpack. Evidence included unprocessed title variable (`<%= ... %>`) and missing `<script src="bundle.js">` tag in the served HTML source.
    *   **Solution:** Created a `vercel.json` file in the project root specifying `"outputDirectory": "dist"`. This explicitly tells Vercel to serve content from the Webpack build output directory, ensuring the processed `index.html` (with injected scripts) is used.
    *   *(Note: As part of debugging this, we also simplified `HtmlWebpackPlugin` config by removing the `title` option and hardcoding the title in `index.html`, and removed the `inject: 'body'` option, relying on defaults. These simplifications were kept but the root cause was likely the missing `vercel.json` config).* 

5.  **TypeScript Configuration (`tsconfig.json`):**
    *   **Finding:** `outDir: "./dist"` was specified, which is unnecessary when using Webpack/`ts-loader` to handle bundling and output.
    *   **Solution:** Removed the `outDir` setting to avoid potential confusion.

## Open Questions / Future Considerations

*   **Web Audio API & Mobile Browsers:** Unlocking the Web Audio API requires a user gesture (`pointerdown`, `click`, etc.). Relying solely on `pointerdown` within the game canvas might not be reliable on all mobile browsers/OS versions. Implementing a dedicated "Tap to Start" or button click is more robust.
*   **Vercel Build Differences:** Issues encountered during development (e.g., game freezing) might not appear locally but manifest in the Vercel production build. This often relates to timing, initialization order, or subtle differences in how browsers handle APIs in production environments.
*   **Phaser Sound Manager Initialization:** Interacting with `this.sound.add()` or `this.sound.context.resume()` too early in the `create` method, before the game is fully initialized or without a preceding user gesture, can cause freezes or errors, especially in production builds.
*   **Asset Paths & `public` Directory:** Files placed in Vite's `public` directory are served from the root of the deployed site. Reference them in code using relative paths *without* the `public` prefix (e.g., `assets/audio/file.mp3`). Ensure these assets are tracked by Git, otherwise they won't be included in the Vercel deployment.
*   **iPad Audio Playback:** Encountered persistent issues getting Web Audio playback to work reliably on iPad within the Vercel deployment, despite trying various standard and alternative timing patterns for `AudioContext.resume()` and `sound.play()`. Works on desktop/iPhone. Accepted as a limitation for v1.

--- 